{# Tailwind agent row partial #}
{% set tier_classes = {
  1: {'badge': 'bg-amber-100 text-amber-700', 'icon': 'bi-star-fill', 'label': 'Tier 1'},
  2: {'badge': 'bg-sky-100 text-sky-700', 'icon': 'bi-star-half', 'label': 'Tier 2'},
  3: {'badge': 'bg-gray-100 text-gray-600', 'icon': 'bi-star', 'label': 'Tier 3'}
} %}

<tr id="agent-row-{{ agent.id }}"
    class="agent-row cursor-pointer transition hover:bg-primary/5"
    onclick="toggleAgentDetails('agent-{{ agent.id }}')"
    data-tier="{% if agent.tier == 1 %}specialist{% elif agent.tier == 2 %}sub{% else %}unknown{% endif %}"
    data-active="{% if agent.is_active %}active{% else %}inactive{% endif %}"
    data-name="{{ agent.name }}"
    data-role="{{ agent.role }}"
    data-last_used="{{ agent.last_used_at.isoformat() if agent.last_used_at else '1970-01-01' }}"
    data-assigned_tasks="{{ agent.assigned_task_count }}"
    data-active_tasks="{{ agent.active_task_count }}">
  <td class="px-6 py-4 text-sm font-semibold text-gray-900" data-sort-value="name" data-value="{{ agent.name }}">{{ agent.name }}</td>
  <td class="px-4 py-4" data-sort-value="role" data-value="{{ agent.role }}">
    <span class="inline-flex items-center gap-2 rounded-full bg-sky-100 px-3 py-1 text-xs font-semibold text-sky-700">{{ agent.role }}</span>
  </td>
  <td class="px-4 py-4">
    {% if agent.tier and agent.tier in tier_classes %}
      {% set tier = tier_classes[agent.tier] %}
      <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold {{ tier.badge }}">
        <i class="bi {{ tier.icon }}"></i>
        {{ tier.label }}
      </span>
    {% else %}
      <span class="text-xs text-gray-400">â€”</span>
    {% endif %}
  </td>
  <td class="px-4 py-4 text-sm text-gray-600" data-sort-value="last_used" data-value="{{ agent.last_used_at.isoformat() if agent.last_used_at else '1970-01-01' }}">
    {% if agent.last_used_at %}
      {% set now = agent.last_used_at.__class__.now() %}
      {% set days_ago = (now - agent.last_used_at).days %}
      {% if days_ago == 0 %}
        <span class="text-emerald-600">Today</span>
      {% elif days_ago == 1 %}
        <span class="text-emerald-600">Yesterday</span>
      {% elif days_ago <= 7 %}
        <span class="text-primary">{{ days_ago }}d ago</span>
      {% elif days_ago <= 30 %}
        <span class="text-gray-500">{{ days_ago }}d ago</span>
      {% else %}
        <span class="text-gray-400">{{ (days_ago // 30) }}mo ago</span>
      {% endif %}
    {% else %}
      <span class="text-gray-400">Never</span>
    {% endif %}
  </td>
  <td class="px-4 py-4 text-sm" data-sort-value="assigned_tasks" data-value="{{ agent.assigned_task_count }}">
    <span class="inline-flex items-center justify-center rounded-full bg-gray-100 px-3 py-1 text-xs font-semibold text-gray-600">
      {{ agent.assigned_task_count }}
    </span>
  </td>
  <td class="px-4 py-4 text-sm" data-sort-value="active_tasks" data-value="{{ agent.active_task_count }}">
    {% if agent.active_task_count > 0 %}
      <span class="inline-flex items-center justify-center rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">
        {{ agent.active_task_count }}
      </span>
    {% else %}
      <span class="inline-flex items-center justify-center rounded-full bg-gray-100 px-3 py-1 text-xs font-semibold text-gray-500">0</span>
    {% endif %}
  </td>
  <td class="px-4 py-4 text-right">
    <label class="inline-flex cursor-pointer items-center gap-2" onclick="event.stopPropagation()" for="agent-toggle-{{ agent.id }}">
      <input type="checkbox"
             class="peer sr-only"
             id="agent-toggle-{{ agent.id }}"
             {% if agent.is_active %}checked{% endif %}
             hx-post="/agents/{{ agent.id }}/toggle"
             hx-target="#agent-row-{{ agent.id }}"
             hx-swap="outerHTML"
             hx-trigger="change"
             aria-label="Toggle {{ agent.name }} agent status (currently {{ 'active' if agent.is_active else 'inactive' }})"
             aria-describedby="agent-status-{{ agent.id }}">
      <span class="relative h-5 w-9 rounded-full bg-gray-300 transition peer-checked:bg-emerald-500" aria-hidden="true">
        <span class="absolute left-1 top-1 h-3 w-3 rounded-full bg-white transition peer-checked:translate-x-4"></span>
      </span>
      <span id="agent-status-{{ agent.id }}" class="text-xs font-semibold {{ 'text-emerald-600' if agent.is_active else 'text-gray-400' }}">
        {{ 'Active' if agent.is_active else 'Inactive' }}
      </span>
    </label>
  </td>
</tr>
<tr id="agent-{{ agent.id }}" class="hidden">
  <td colspan="7" class="bg-gray-50 px-6 py-4">
    <div class="grid gap-6 md:grid-cols-2">
      <div class="space-y-3">
        <p class="text-sm text-gray-600">
          <span class="font-semibold text-gray-800">Description:</span>
          {{ agent.description if agent.description else 'No description available' }}
        </p>
        {% if agent.capabilities %}
        <div>
          <p class="text-sm font-semibold text-gray-800">Capabilities</p>
          <ul class="mt-2 list-disc space-y-1 pl-5 text-sm text-gray-600">
            {% for capability in agent.capabilities %}
            <li>{{ capability }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
      <div class="space-y-3 text-sm text-gray-600">
        <div>
          <p class="font-semibold text-gray-800">System Information</p>
          <ul class="mt-2 space-y-1">
            <li><span class="text-xs text-gray-400">Created:</span> {{ agent.created_at.strftime('%Y-%m-%d %H:%M') if agent.created_at else 'N/A' }}</li>
            <li><span class="text-xs text-gray-400">Updated:</span> {{ agent.updated_at.strftime('%Y-%m-%d %H:%M') if agent.updated_at else 'N/A' }}</li>
          </ul>
        </div>
        {% if agent.assigned_task_count > 0 %}
        <div class="pt-2">
          <button class="inline-flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-xs font-medium text-gray-500 shadow-sm" disabled>
            View tasks (coming soon)
          </button>
        </div>
        {% endif %}
      </div>
    </div>
  </td>
</tr>
