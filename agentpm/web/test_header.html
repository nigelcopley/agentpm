<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Header Test - APM (Agent Project Manager)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body class="h-full bg-gray-50">
    <!-- Test Header -->
    <header
      x-data="headerController()"
      class="sticky top-0 z-50 border-b border-gray-200 bg-white/90 backdrop-blur shadow-sm"
    >
      <div class="flex h-16 w-full items-center justify-between px-4 sm:px-6 lg:px-8">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-3">
          <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-sm">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h12M4 18h8"></path>
            </svg>
          </span>
          <span class="hidden sm:block">
            <span class="block text-base font-semibold text-gray-900">APM (Agent Project Manager)</span>
            <span class="block text-xs font-medium uppercase tracking-wide text-gray-500">AI Project Manager</span>
          </span>
        </a>

        <!-- Collapsible Search -->
        <div class="mx-4 flex-1 items-center md:flex">
          <div class="relative w-full max-w-xl" x-show="searchOpen" x-transition>
            <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-gray-400">
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35M5 11a6 6 0 1 1 12 0 6 6 0 0 1-12 0Z" />
              </svg>
            </span>
            <input
              x-ref="search"
              x-model="searchQuery"
              @keydown.enter.prevent="submitSearch"
              @keydown.escape="searchOpen = false"
              type="search"
              name="global-search"
              autocomplete="off"
              placeholder="Search ideas, work items, tasks, agents..."
              class="w-full rounded-xl border border-gray-200 bg-white py-2 pl-10 pr-12 text-sm text-gray-700 shadow-sm outline-none transition focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30"
            />
            <span class="pointer-events-none absolute inset-y-0 right-3 hidden items-center gap-1 rounded-md border border-gray-200 bg-gray-50 px-2 text-xs font-medium text-gray-500 sm:flex">
              <span class="font-mono">⌘K</span>
            </span>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="flex items-center gap-2">
          <button
            @click="searchOpen = !searchOpen; if (searchOpen) { $nextTick(() => $refs.search?.focus()) }"
            class="hidden rounded-lg border border-gray-200 bg-white px-3 py-2 text-xs font-medium text-gray-600 shadow-sm transition hover:border-blue-500/30 hover:text-blue-500 sm:inline-flex"
            title="Search"
          >
            <i class="bi bi-search"></i>
          </button>
          
          <div class="relative hidden sm:block" x-data="{ open: false }">
            <button
              type="button"
              class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600 shadow-sm"
              @click="open = !open"
              :aria-expanded="open.toString()"
            >
              <i class="bi bi-gear-fill"></i>
            </button>
            <div
              x-cloak
              x-show="open"
              x-transition
              @click.away="open = false"
              class="absolute right-0 mt-2 w-52 rounded-lg border border-gray-200 bg-white p-2 shadow-lg z-50"
              style="max-width: calc(100vw - 2rem);"
            >
              <button type="button" class="flex w-full items-center justify-between rounded-md px-3 py-2 text-left text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600" @click="showKeyboardShortcuts(); open = false">
                <span class="flex items-center gap-2">
                  <i class="bi bi-keyboard"></i>
                  Keyboard Shortcuts
                </span>
                <kbd class="rounded border border-gray-300 bg-gray-50 px-1.5 py-0.5 font-mono text-xs">?</kbd>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Test Content -->
    <main class="min-h-screen p-8">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Header Functionality Test</h1>
        
        <div class="space-y-6">
          <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Search Functionality</h2>
            <p class="text-gray-600 mb-4">Click the search icon in the header or press ⌘K (Ctrl+K) to open the search box.</p>
            <div class="space-y-2">
              <p class="text-sm text-gray-500">• Search icon should expand/collapse the search box</p>
              <p class="text-sm text-gray-500">• ⌘K should open search and focus the input</p>
              <p class="text-sm text-gray-500">• Escape should close the search box</p>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Keyboard Shortcuts Modal</h2>
            <p class="text-gray-600 mb-4">Click "Keyboard Shortcuts" in the gear menu or press ? to open the modal.</p>
            <div class="space-y-2">
              <p class="text-sm text-gray-500">• Gear menu should show dropdown</p>
              <p class="text-sm text-gray-500">• "Keyboard Shortcuts" should open modal</p>
              <p class="text-sm text-gray-500">• ? key should open modal (when not in input field)</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Global Modal System -->
    <div
        id="global-modal"
        x-data="{
            open: false,
            type: '',
            data: {},
            
            showModal(type, data = {}) {
                this.type = type;
                this.data = data;
                this.open = true;
            },
            
            hideModal() {
                this.open = false;
                this.type = '';
                this.data = {};
            }
        }"
        x-show="open"
        x-cloak
        @keydown.escape.window="hideModal()"
        class="fixed inset-0 z-[9999] flex items-center justify-center bg-gray-900/50 backdrop-blur-sm"
        style="display: none;"
    >
        <div
            @click.away="hideModal()"
            class="relative mx-4 w-full max-w-2xl rounded-xl border border-gray-200 bg-white p-6 shadow-2xl"
        >
            <!-- Keyboard Shortcuts Modal -->
            <template x-if="type === 'keyboard-shortcuts'">
                <div>
                    <!-- Header -->
                    <div class="mb-6 flex items-center justify-between">
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900">Keyboard Shortcuts</h2>
                            <p class="text-sm text-gray-600">Quick access to common actions</p>
                        </div>
                        <button
                            type="button"
                            @click="hideModal()"
                            class="flex h-8 w-8 items-center justify-center rounded-lg text-gray-400 transition hover:bg-gray-100 hover:text-gray-600"
                        >
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>

                    <!-- Shortcuts Grid -->
                    <div class="space-y-6">
                        <!-- Navigation -->
                        <div>
                            <h3 class="mb-3 text-sm font-semibold uppercase tracking-wider text-gray-500">Navigation</h3>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between rounded-lg border border-gray-200 px-4 py-3">
                                    <span class="text-sm text-gray-700">Global search</span>
                                    <kbd class="rounded border border-gray-300 bg-gray-50 px-2 py-1 font-mono text-xs">⌘K</kbd>
                                </div>
                                <div class="flex items-center justify-between rounded-lg border border-gray-200 px-4 py-3">
                                    <span class="text-sm text-gray-700">Show keyboard shortcuts</span>
                                    <kbd class="rounded border border-gray-300 bg-gray-50 px-2 py-1 font-mono text-xs">?</kbd>
                                </div>
                            </div>
                        </div>

                        <!-- Tips -->
                        <div class="rounded-lg bg-blue-50 p-4">
                            <div class="flex items-start gap-3">
                                <i class="bi bi-lightbulb text-blue-600"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Pro tip</p>
                                    <p class="text-sm text-gray-600">Use the search bar (⌘K) to quickly find ideas, work items, tasks, agents, and more across the entire system.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
        // Global modal system
        window.ModalSystem = {
            showKeyboardShortcuts() {
                const modal = document.getElementById('global-modal');
                if (modal && modal.__x) {
                    modal.__x.$data.showModal('keyboard-shortcuts');
                }
            },
            
            showModal(type, data = {}) {
                const modal = document.getElementById('global-modal');
                if (modal && modal.__x) {
                    modal.__x.$data.showModal(type, data);
                }
            },
            
            hideModal() {
                const modal = document.getElementById('global-modal');
                if (modal && modal.__x) {
                    modal.__x.$data.hideModal();
                }
            }
        };
        
        // Header controller
        function headerController() {
            return {
                searchQuery: '',
                searchOpen: false,
                mobileOpen: false,
                
                submitSearch() {
                    if (this.searchQuery.trim()) {
                        alert(`Searching for: ${this.searchQuery}`);
                        // window.location.href = `/search?q=${encodeURIComponent(this.searchQuery)}`;
                    }
                },
                
                showKeyboardShortcuts() {
                    window.ModalSystem.showKeyboardShortcuts();
                },
                
                showNotifications() {
                    console.log('Notifications clicked');
                }
            }
        }
        
        // Register Alpine.js components
        document.addEventListener('alpine:init', () => {
            Alpine.data('headerController', headerController);
        });
        
        // Fallback for when Alpine.js is already loaded
        if (window.Alpine) {
            Alpine.data('headerController', headerController);
        }
        
        // Global keyboard shortcuts
        window.addEventListener('keydown', (event) => {
            // ⌘K / Ctrl+K: Focus search
            if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'k') {
                event.preventDefault();
                const header = document.querySelector('header[x-data*="headerController"]');
                if (!header || !header.__x) return;
                
                // Open search if not already open
                if (!header.__x.$data.searchOpen) {
                    header.__x.$data.searchOpen = true;
                    header.__x.$nextTick(() => {
                        const searchInput = header.querySelector('input[name="global-search"]') || header.querySelector('input[type="search"]');
                        if (searchInput) {
                            searchInput.focus();
                            searchInput.select();
                        }
                    });
                } else {
                    const searchInput = header.querySelector('input[name="global-search"]') || header.querySelector('input[type="search"]');
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.select();
                    }
                }
            }

            // ?: Show keyboard shortcuts help
            if (event.key === '?' && !event.shiftKey && !event.metaKey && !event.ctrlKey && !event.altKey) {
                // Only trigger if not in an input field
                if (event.target.tagName !== 'INPUT' && event.target.tagName !== 'TEXTAREA') {
                    event.preventDefault();
                    window.ModalSystem.showKeyboardShortcuts();
                }
            }
        });
    </script>
</body>
</html>
