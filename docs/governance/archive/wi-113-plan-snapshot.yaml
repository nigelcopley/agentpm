# plan.snapshot - WI-113: Document Path Validation Enforcement

artifact_type: plan.snapshot
gate: P1
status: PASS
work_item_id: 113
created: 2025-10-19T00:00:00Z
confidence: 0.92

# WORK ITEM SUMMARY
work_item:
  id: 113
  name: "Document Path Validation Enforcement"
  type: bugfix
  priority: 1
  business_context: "Document system has critical path validation flaw affecting 80% of documents"
  root_cause: "Two model files with conflicting validators, weak one is active"
  impact: "50 documents in root directory instead of docs/{category}/{document_type}/{filename} structure"

# TASK BREAKDOWN (10 tasks, 22.3 hours estimated)
tasks:
  - id: 588
    title: "Consolidate DocumentReference models with strict validation"
    type: IMPLEMENTATION
    estimate: 3.3h
    dependencies: []
    specialist: "aipm-database-developer"
    ac_mapping: ["AC2"]
    risks: ["R2"]
    
  - id: 589
    title: "Add database CHECK constraint for docs/ prefix"
    type: IMPLEMENTATION
    estimate: 1.5h
    dependencies: [588]
    specialist: "aipm-database-developer"
    ac_mapping: ["AC3"]
    risks: ["R4"]
    
  - id: 590
    title: "Create comprehensive path validation tests"
    type: TESTING
    estimate: 3.0h
    dependencies: [588]
    specialist: "aipm-testing-specialist"
    ac_mapping: ["AC6"]
    risks: ["R6"]
    
  - id: 591
    title: "Implement document migration CLI command"
    type: IMPLEMENTATION
    estimate: 4.0h
    dependencies: [588, 589, 590]
    specialist: "aipm-python-cli-developer"
    ac_mapping: ["AC1"]
    risks: ["R1", "R5"]
    scope_note: "Scope reduced to manual category/type input (no auto-inference)"
    
  - id: 592
    title: "Execute migration of 50 root documents"
    type: DEPLOYMENT
    estimate: 1.2h
    dependencies: [591]
    specialist: "aipm-python-cli-developer"
    ac_mapping: ["AC1"]
    risks: ["R1"]
    
  - id: 593
    title: "Verify migration success and metadata preservation"
    type: TESTING
    estimate: 1.1h
    dependencies: [592]
    specialist: "aipm-testing-specialist"
    ac_mapping: ["AC1", "AC6"]
    risks: ["R4"]
    
  - id: 594
    title: "Update agent SOPs with path structure examples"
    type: DOCUMENTATION
    estimate: 2.2h
    dependencies: [588]
    specialist: "aipm-documentation-specialist"
    ac_mapping: ["AC4"]
    risks: ["R3"]
    
  - id: 595
    title: "Enhance CLI with path guidance and warnings"
    type: IMPLEMENTATION
    estimate: 1.5h
    dependencies: [588]
    specialist: "aipm-python-cli-developer"
    ac_mapping: ["AC5"]
    risks: ["R3"]
    
  - id: 596
    title: "Comprehensive regression testing suite"
    type: TESTING
    estimate: 3.0h
    dependencies: [590, 593, 594, 595]
    specialist: "aipm-testing-specialist"
    ac_mapping: ["AC6"]
    risks: ["R6"]
    
  - id: 597
    title: "Update documentation (user guides + developer guides)"
    type: DOCUMENTATION
    estimate: 1.5h
    dependencies: [593, 594]
    specialist: "aipm-documentation-specialist"
    ac_mapping: ["AC4"]

# EXECUTION PLAN
execution_phases:
  phase_1_foundation:
    tasks: [588]
    duration: 3.3h
    parallelizable: false
    description: "BLOCKING - All other tasks depend on this"
    
  phase_2_validation_setup:
    tasks: [589, 590]
    duration: 3.0h  # max(1.5, 3.0)
    parallelizable: true
    description: "Database constraint + test suite"
    
  phase_3_prevention:
    tasks: [594, 595]
    duration: 2.2h  # max(2.2, 1.5)
    parallelizable: true
    description: "Agent SOPs + CLI UX (can overlap with migration prep)"
    
  phase_4_migration:
    tasks: [591]
    duration: 4.0h
    parallelizable: false
    description: "Build migration command"
    
  phase_5_execution:
    tasks: [592]
    duration: 1.2h
    parallelizable: false
    description: "Execute migration on 50 documents"
    
  phase_6_verification:
    tasks: [593]
    duration: 1.1h
    parallelizable: false
    description: "Verify migration success"
    
  phase_7_final_validation:
    tasks: [596, 597]
    duration: 3.0h  # max(3.0, 1.5)
    parallelizable: true
    description: "Regression tests + documentation"

# ESTIMATES
estimates:
  total_hours_sequential: 22.3h
  total_hours_parallel: 18.8h
  critical_path: [588, 589, 591, 592, 593, 596]
  critical_path_duration: 14.1h
  parallel_time_saved: 3.5h

# RISK MITIGATION
risks:
  R1_data_loss_during_migration:
    severity: CRITICAL
    probability: 0.30
    impact: 9/10
    mitigation_tasks: [591, 592, 593]
    preventive: ["Backup", "Dry-run", "Atomic operations", "Checksums"]
    status: MITIGATED
    
  R2_breaking_imports:
    severity: HIGH
    probability: 0.50
    impact: 7/10
    mitigation_tasks: [588, 590]
    preventive: ["Grep imports", "Systematic update", "Isolation testing"]
    status: MITIGATED
    
  R3_agent_workflow_disruption:
    severity: MEDIUM
    probability: 0.40
    impact: 5/10
    mitigation_tasks: [594, 595]
    preventive: ["Update SOPs", "CLI validation", "Examples"]
    status: MITIGATED
    
  R4_database_constraint_blocks_migration:
    severity: MEDIUM
    probability: 0.25
    impact: 6/10
    mitigation_tasks: [589, 593]
    preventive: ["Add constraint AFTER migration", "Test timing"]
    status: MITIGATED
    
  R5_scope_creep:
    severity: LOW
    probability: 0.60
    impact: 3/10
    mitigation_tasks: [591]
    preventive: ["Scope reduced - manual input only"]
    status: MITIGATED
    
  R6_insufficient_test_coverage:
    severity: MEDIUM
    probability: 0.35
    impact: 6/10
    mitigation_tasks: [590, 593, 596]
    preventive: ["Edge cases", "Error conditions", "Coverage tools"]
    status: MITIGATED

# ACCEPTANCE CRITERIA COVERAGE
acceptance_criteria_coverage:
  AC1_migration_complete:
    description: "All 50 non-compliant documents migrated to docs/ structure"
    tasks: [591, 592, 593]
    coverage: FULL
    
  AC2_model_consolidated:
    description: "DocumentReference model consolidated with strict path validation"
    tasks: [588]
    coverage: FULL
    
  AC3_database_constraint:
    description: "Database CHECK constraint enforces docs/ prefix"
    tasks: [589]
    coverage: FULL
    
  AC4_sops_updated:
    description: "Agent SOPs updated with path structure examples (46 files)"
    tasks: [594, 597]
    coverage: FULL
    
  AC5_cli_guidance:
    description: "CLI provides guidance/warnings for non-compliant paths"
    tasks: [595]
    coverage: FULL
    
  AC6_regression_tests:
    description: "Regression tests prevent future violations (>90% coverage)"
    tasks: [590, 593, 596]
    coverage: FULL

# QUALITY COMPLIANCE
compliance:
  time_boxing:
    implementation_tasks: "All ≤4.0h (DP-001)"
    testing_tasks: "All ≤6.0h (DP-002)"
    documentation_tasks: "All ≤4.0h (DP-004)"
    deployment_tasks: "All ≤2.0h (DP-005)"
    violations: []
    status: COMPLIANT
    
  task_types:
    required_for_bugfix: ["IMPLEMENTATION", "TESTING"]
    present: ["IMPLEMENTATION", "TESTING", "DOCUMENTATION", "DEPLOYMENT"]
    status: COMPLIANT
    
  coverage_target:
    requirement: ">90% (TEST-021)"
    tasks_addressing: [590, 593, 596]
    status: ADDRESSED

# P1 GATE VALIDATION
p1_gate:
  criteria:
    ac_mapping: PASS
    time_boxing: PASS
    dependencies_mapped: PASS
    mitigations_planned: PASS
  overall_status: PASS
  confidence: 0.92
  missing_criteria: []
  
# NEXT PHASE
next_phase: I1_IMPLEMENTATION
next_orchestrator: implementation-orch
ready_for_execution: true

# DATABASE VERIFICATION
database:
  work_item_id: 113
  task_ids: [588, 589, 590, 591, 592, 593, 594, 595, 596, 597]
  task_count: 10
  dependency_count: 14
  all_tasks_in_database: true
  all_dependencies_in_database: true

# NOTES
notes:
  - "Task 591 scope reduced to stay within 4.0h time-box (no auto-inference)"
  - "Database CHECK constraint (T589) added AFTER migration (T593) to prevent blocking"
  - "Critical path: 14.1h, can parallelize to 18.8h total"
  - "All 6 risks have mitigation plans integrated into task implementation notes"
  - "100% acceptance criteria coverage with multiple tasks per AC"
  - "Ready to transition to I1_IMPLEMENTATION phase"
